<!DOCTYPE html>
<html>
<head>
  <title>Pangram Tester</title>
  <style>
    /* CSS styles here */
  </style>
</head>
<body>
  <h1>Pangram Tester</h1>
  <p class="subtitle">Pangram authoring tool</p>

  <div class="input-container">
    <p>Enter a sentence:</p>
    <input type="text" id="sentenceInput" oninput="analyzeSentence()">
  </div>

  <div class="output">
    <p id="sentenceOutput"></p>
    <p id="statusOutput"></p>
  </div>

  <div class="suggestion-container">
    <p class="suggestion-title">Word Suggestions:</p>
    <ul id="suggestionList" class="suggestion-list"></ul>
  </div>

  <script>
    // Load the dictionary file once
    var dictionary = [];

    function loadDictionary() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'words_alpha.txt', true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          dictionary = xhr.responseText.split('\n');
        }
      };
      xhr.send();
    }

    loadDictionary();

    function createHighlightSpan(text) {
      var span = document.createElement("span");
      span.textContent = text;
      span.classList.add("highlight");
      return span;
    }

    function analyzeSentence() {
      var sentenceInput = document.getElementById("sentenceInput");
      var sentenceOutput = document.getElementById("sentenceOutput");
      var statusOutput = document.getElementById("statusOutput");
      var suggestionList = document.getElementById("suggestionList");

      var sentence = sentenceInput.value;
      var lowercaseSentence = sentence.toLowerCase();
      var alphabet = "abcdefghijklmnopqrstuvwxyz";
      var lettersFound = [];
      var lettersMissing = [];

      sentenceOutput.textContent = ""; // Clear previous output
      statusOutput.textContent = ""; // Clear previous status
      suggestionList.innerHTML = ""; // Clear previous suggestions

      if (sentence.trim() === "") {
        return; // If input is empty, leave the results empty
      }

      var sentenceLettersCount = 0;

      for (var i = 0; i < lowercaseSentence.length; i++) {
        var char = lowercaseSentence.charAt(i);
        if (alphabet.includes(char) && !lettersFound.includes(char)) {
          lettersFound.push(char);
          sentenceOutput.appendChild(createHighlightSpan(sentence.charAt(i)));
        } else {
          sentenceOutput.appendChild(document.createTextNode(sentence.charAt(i)));
        }
        if (alphabet.includes(char)) {
          sentenceLettersCount++;
        }
      }

      // Determine missing letters
      for (var j = 0; j < alphabet.length; j++) {
        var letter = alphabet.charAt(j);
        if (!lettersFound.includes(letter)) {
          lettersMissing.push(letter);
        }
      }

      var missingLettersCount = lettersMissing.length;

      if (missingLettersCount === 0) {
        statusOutput.textContent = "Valid pangram!";
      } else {
        var missingLettersText = "Missing " + missingLettersCount + " letter(s): " + lettersMissing.join(" ");
        var missingLettersSpan = document.createElement("span");
        missingLettersSpan.classList.add("missing-letters");
        missingLettersSpan.textContent = missingLettersText;
        statusOutput.appendChild(missingLettersSpan);
      }

      var lettersCountText = "Letters in sentence: " + sentenceLettersCount;
      statusOutput.appendChild(document.createElement("br"));
      statusOutput.appendChild(document.createTextNode(lettersCountText));

      // Generate word suggestions
      var suggestions = suggestWords(lettersMissing, lettersFound);
      var suggestionLimit = 30;
      suggestions.slice(0, suggestionLimit).forEach(function (suggestion) {
        var li = document.createElement("li");
        var formattedWord = suggestion.word;
        suggestion.highlightedLetters.forEach(function (letter) {
          var regex = new RegExp(letter, 'i');
          var span = createHighlightSpan(letter);
          formattedWord = formattedWord.replace(regex, span.textContent);
        });
        li.textContent = formattedWord;
        suggestionList.appendChild(li);
      });
    }

    function suggestWords(lettersMissing, lettersFound) {
      var suggestions = [];

      dictionary.forEach(function (word) {
        var wordLetters = word.split('');
        var score = 0;

        lettersMissing.forEach(function (missingLetter) {
          if (wordLetters.includes(missingLetter)) {
            score++;
            wordLetters.splice(wordLetters.indexOf(missingLetter), 1);
          }
        });

        lettersFound.forEach(function (foundLetter) {
          if (wordLetters.includes(foundLetter)) {
            score--;
            wordLetters.splice(wordLetters.indexOf(foundLetter), 1);
          }
        });

        if (score > 0) {
          suggestions.push({
            word: word,
            score: score
          });
        }
      });

      // Sort suggestions based on the score
      suggestions.sort(function (a, b) {
        return b.score - a.score;
      });

      // Get the first instance of each missing letter in the suggestions
      var missingLetterInstances = {};
      lettersMissing.forEach(function (letter) {
        missingLetterInstances[letter] = true;
      });

      var uniqueSuggestions = [];
      suggestions.forEach(function (suggestion) {
        var suggestionLetters = suggestion.word.split('');
        var highlightedLetters = [];
        suggestionLetters.forEach(function (letter) {
          if (missingLetterInstances[letter]) {
            highlightedLetters.push(letter);
            missingLetterInstances[letter] = false;
          }
        });
        suggestion.highlightedLetters = highlightedLetters;
        uniqueSuggestions.push(suggestion);
      });

      return uniqueSuggestions;
    }
  </script>
</body>
</html>
